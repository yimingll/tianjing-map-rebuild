<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬¢è¿ä¿¡æ¯å¯¹é½æµ‹è¯•</title>
  <style>
    @font-face {
      font-family: 'Sarasa Term SC Nerd';
      src: url('/fonts/SarasaTermSCNerd-Regular.ttf') format('truetype');
      font-weight: 400;
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Sarasa Term SC Nerd', monospace;
      background: #1a1a1a;
      color: #e0e0e0;
      font-size: 14px;
      line-height: 1.2;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: #4CAF50;
    }

    .preview {
      white-space: pre;
      background: #2a2a2a;
      padding: 10px;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      overflow-x: auto;
      margin: 20px 0;
    }

    .stats {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
    }

    .stats h3 {
      margin-top: 0;
      color: #64B5F6;
    }

    .line-info {
      font-size: 12px;
      margin: 5px 0;
      padding: 3px 5px;
      border-radius: 3px;
    }

    .error-line {
      background-color: rgba(244, 67, 54, 0.2);
      color: #ff6b6b;
    }

    .good-line {
      background-color: rgba(76, 175, 80, 0.1);
      color: #81c784;
    }

    .controls {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-family: inherit;
    }

    button:hover {
      background: #45a049;
    }

    .ruler {
      white-space: pre;
      color: #666;
      font-size: 12px;
      background: #1e1e1e;
      padding: 5px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¨ æ¬¢è¿ä¿¡æ¯å¯¹é½æµ‹è¯•å·¥å…·</h1>

    <div class="ruler">0----+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8</div>

    <div class="controls">
      <button onclick="loadWelcomeMessage()">ğŸ“¥ åŠ è½½æ¬¢è¿ä¿¡æ¯</button>
      <button onclick="analyzeAlignment()">ğŸ” åˆ†æå¯¹é½</button>
      <button onclick="exportReport()">ğŸ“Š å¯¼å‡ºæŠ¥å‘Š</button>
    </div>

    <div class="preview" id="preview">åŠ è½½ä¸­...</div>

    <div class="stats" id="stats"></div>
  </div>

  <script>
    let canvas, ctx;
    let welcomeText = '';

    function init() {
      canvas = document.createElement('canvas');
      ctx = canvas.getContext('2d');
      ctx.font = '14px "Sarasa Term SC Nerd"';

      document.fonts.ready.then(() => {
        loadWelcomeMessage();
      });
    }

    function measureWidth(text) {
      return ctx.measureText(text).width;
    }

    async function loadWelcomeMessage() {
      // æ¨¡æ‹Ÿæ¬¢è¿ä¿¡æ¯ï¼ˆä»æœåŠ¡å™¨è·å–çš„å†…å®¹ï¼‰
      welcomeText = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘         â•”â•â•â•â•—                                          â•”â•â•â•â•—         â•‘
â•‘         â•‘   â•‘==========================================â•‘   â•‘         â•‘
â•‘         â•‘   â•‘                                          â•‘   â•‘         â•‘
â•‘         â•‘ âœ¦ â•‘          X I U X I A N    M U D          â•‘ âœ¦ â•‘         â•‘
â•‘         â•‘   â•‘                                          â•‘   â•‘         â•‘
â•‘         â•‘   â•‘          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”          â•‘   â•‘         â•‘
â•‘         â•‘   â•‘             ã€Š ç„ é‰´ ä»™ å½• ã€‹            â•‘   â•‘         â•‘
â•‘         â•‘   â•‘          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”          â•‘   â•‘         â•‘
â•‘         â•‘   â•‘                                          â•‘   â•‘         â•‘
â•‘         â•‘   â•‘     Xuanjian Chronicles of Immortals     â•‘   â•‘         â•‘
â•‘         â•‘   â•‘                                          â•‘   â•‘         â•‘
â•‘         â•‘   â•‘==========================================â•‘   â•‘         â•‘
â•‘         â•šâ•â•â•â•                                          â•šâ•â•â•â•         â•‘
â•‘                                                                      â•‘
â•‘           âœ¿~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~âœ¿             â•‘
â•‘                                                                      â•‘
â•‘                        "ä»¥ç„é‰´ä¹‹çœ¼ï¼Œè§‚ä¸‡ä¸–æ²‰æµ®"                      â•‘
â•‘                        "ä»¥ä»™å½•ä¹‹ç¬”ï¼Œä¹¦åƒç§‹ä¼ å¥‡"                      â•‘
â•‘                                                                      â•‘
â•‘           âœ¿~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~âœ¿             â•‘
â•‘                                                                      â•‘
â•‘    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•‘                          ã€å·é¦–è¯­ã€‘                          â•‘  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•‘           å¤©åœ°åˆå¼€ï¼Œé¸¿è’™æœªåˆ¤ï¼Œä¸Šå¤ä»™äººç‚¼åˆ¶ç„é‰´å®é•œï¼Œ         â•‘  â•‘
â•‘    â•‘               å¯ç…§çœŸä¼ªï¼Œè¾¨å–„æ¶ï¼Œå¯Ÿå¤©æœºï¼Œæ‚Ÿå¤§é“ã€‚             â•‘  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•‘             å²æœˆæµè½¬ï¼Œçµæ°”å¤è‹ï¼Œä¿®çœŸç››ä¸–å†ä¸´äººé—´ã€‚           â•‘  â•‘
â•‘    â•‘            æ— æ•°ä¿®å£«è¸ä¸Šæ±‚é“ä¹‹è·¯ï¼Œäºè¿™ä»™å½•ä¹‹ä¸­ç•™åã€‚          â•‘  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•‘
â•‘                                                                      â•‘
â•‘    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â•‘
â•‘    â•‘  âœ¦ ä»™ç•Œå®æ—¶ âœ¦                                                â•‘  â•‘
â•‘    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•‘  åœ¨çº¿ä¿®å£«: 0  äºº             ç‰ˆæœ¬: ç„é‰´åˆå¯ 5.0.1            â•‘  â•‘
â•‘    â•‘  çµæ°”æµ“åº¦: å……æ²›              è¿è¡ŒçŠ¶æ€: ç¨³å®š                  â•‘  â•‘
â•‘    â•‘  ä»Šæ—¥å¤©è±¡: ç´«æ°”ä¸œæ¥          æ›´æ–°: ç‚¼ä¸¹ç³»ç»Ÿå·²å¼€æ”¾            â•‘  â•‘
â•‘    â•‘                                                              â•‘  â•‘
â•‘    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â•‘
â•‘          "ä¸€å·ä»™å½•ï¼Œè®°è½½åƒç§‹åŠŸè¿‡ï¼›ä¸€é¢ç„é‰´ï¼Œæ˜ ç…§ä¸‡ä¸–çœŸç›¸ã€‚"          â•‘
â•‘                                                                      â•‘
â•‘    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” å…¥é—¨æŒ‡å¼• â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“        â•‘
â•‘    â”ƒ                                                              â”ƒ  â•‘
â•‘    â”ƒ  âš¡ æ–°æ‰‹ä¿®å£« - åˆ›å»ºè´¦å·                                      â”ƒ  â•‘
â•‘    â”ƒ     è¾“å…¥: new æˆ– æ–°è´¦å·                                      â”ƒ  â•‘
â•‘    â”ƒ     (ç³»ç»Ÿå°†å¼•å¯¼æ‚¨ä¸€æ­¥æ­¥å®Œæˆæ³¨å†Œ)                            â”ƒ  â•‘
â•‘    â”ƒ                                                              â”ƒ  â•‘
â•‘    â”ƒ  âœ¨ å½’æ¥ä¿®å£« - ç™»å½•è´¦å·                                      â”ƒ  â•‘
â•‘    â”ƒ     connect <ç”¨æˆ·å> <å¯†ç >                                  â”ƒ  â•‘
â•‘    â”ƒ     (å¯ä½¿ç”¨ä¸­æ–‡å‘½ä»¤: ç™»å½• <ç”¨æˆ·å> <å¯†ç >)                  â”ƒ  â•‘
â•‘    â”ƒ                                                              â”ƒ  â•‘
â•‘    â”ƒ  ğŸ“– æŸ¥çœ‹å¸®åŠ©                                                  â”ƒ  â•‘
â•‘    â”ƒ     help                                                     â”ƒ  â•‘
â•‘    â”ƒ                                                              â”ƒ  â•‘
â•‘    â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

      document.getElementById('preview').textContent = welcomeText;
      analyzeAlignment();
    }

    function analyzeAlignment() {
      const preview = document.getElementById('preview');
      const stats = document.getElementById('stats');

      const lines = welcomeText.split('\n');
      let statsHtml = '<h3>ğŸ“Š å¯¹é½åˆ†ææŠ¥å‘Š</h3>';

      // æµ‹é‡æ‰€æœ‰è¡Œ
      const measurements = lines.map((line, index) => {
        const width = measureWidth(line);
        const charCount = line.length;
        return {
          index: index + 1,
          line: line,
          width: width,
          charCount: charCount
        };
      });

      // æ‰¾å‡ºæœ€å¸¸è§çš„å®½åº¦ï¼ˆåº”è¯¥æ˜¯è¾¹æ¡†è¡Œçš„å®½åº¦ï¼‰
      const widths = measurements.map(m => Math.round(m.width));
      const widthCounts = {};
      widths.forEach(w => {
        widthCounts[w] = (widthCounts[w] || 0) + 1;
      });
      const targetWidth = Math.max(...Object.keys(widthCounts).map(Number));

      statsHtml += `<div style="margin-bottom: 15px; padding: 10px; background: #1e1e1e; border-radius: 4px;">`;
      statsHtml += `<strong>ç›®æ ‡å®½åº¦:</strong> ${targetWidth.toFixed(2)}px<br>`;
      statsHtml += `<strong>æ€»è¡Œæ•°:</strong> ${lines.length}<br>`;
      statsHtml += `</div>`;

      let errorCount = 0;
      measurements.forEach(m => {
        const diff = m.width - targetWidth;
        const isGood = Math.abs(diff) < 2; // å…è®¸2åƒç´ è¯¯å·®

        if (!isGood) errorCount++;

        const status = isGood ? 'âœ…' : 'âŒ';
        const lineClass = isGood ? 'good-line' : 'error-line';

        statsHtml += `<div class="line-info ${lineClass}">`;
        statsHtml += `${status} ç¬¬ ${m.index} è¡Œ: ${m.width.toFixed(2)}px `;
        statsHtml += `(${m.charCount} å­—ç¬¦, å·®å€¼: ${diff > 0 ? '+' : ''}${diff.toFixed(2)}px)`;

        // æ˜¾ç¤ºè¡Œå°¾å­—ç¬¦
        const lastChars = m.line.slice(-5);
        statsHtml += `<br><span style="opacity: 0.7;">è¡Œå°¾: "${lastChars}"</span>`;
        statsHtml += `</div>`;
      });

      statsHtml += `<div style="margin-top: 15px; padding: 10px; background: #1e1e1e; border-radius: 4px;">`;
      statsHtml += `<strong>å¯¹é½çŠ¶æ€:</strong> ${lines.length - errorCount} è¡Œå¯¹é½, ${errorCount} è¡Œæœªå¯¹é½`;
      statsHtml += `</div>`;

      stats.innerHTML = statsHtml;
    }

    function exportReport() {
      const lines = welcomeText.split('\n');
      let report = '# æ¬¢è¿ä¿¡æ¯å¯¹é½æŠ¥å‘Š\n\n';

      lines.forEach((line, index) => {
        const width = measureWidth(line);
        report += `è¡Œ ${index + 1}: ${width.toFixed(2)}px (${line.length} å­—ç¬¦)\n`;
      });

      const blob = new Blob([report], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'welcome-alignment-report.txt';
      a.click();
      URL.revokeObjectURL(url);

      alert('æŠ¥å‘Šå·²å¯¼å‡ºï¼');
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
