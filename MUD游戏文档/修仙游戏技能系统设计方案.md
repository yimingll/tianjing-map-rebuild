# 修仙游戏技能系统设计方案

> 基于经典修仙小说（凡人修仙传）和修仙游戏的功法、术法、神通设定

>
> **重要**: 本文档定义功法和术法系统
>
> **依赖系统**: 属性系统(技能加成计算)、境界系统(技能解锁条件)
>
> **参考标准**: 详见《【重要】文档统一标准.md》

---

## 一、技能系统概述

### 1.1 技能体系层次

在修仙世界中，技能分为多个层次：

```
功法（Cultivation Method）
	↓ 修炼基础，决定修炼路线
术法/法术（Spell/Magic Art）
	↓ 基础攻击和防御手段
秘术（Secret Art）
	↓ 强大的特殊技能
神通（Divine Ability）
	↓ 境界高深后领悟的大招
道法（Dao Method）
	↓ 接近大道的终极力量
```

### 1.2 技能分类

#### 按功能分类
- **攻击型**: 造成伤害
- **防御型**: 减少伤害、格挡、护盾
- **辅助型**: 增益、治疗、恢复
- **控制型**: 眩晕、定身、减速
- **位移型**: 瞬移、冲刺、飞行
- **召唤型**: 召唤傀儡、灵兽

#### 按主被动分类
- **主动技能**: 需要手动释放
- **被动技能**: 自动触发或永久生效
- **切换技能**: 可开关的技能

#### 按属性分类
- **五行系**: 金木水火土
- **阴阳系**: 阴属性、阳属性
- **特殊系**: 雷、冰、风、暗等

---

## 二、功法系统（修炼基础）

### 2.1 功法概念

**功法**是修士修炼的根本，决定了：
- 修炼速度
- 真元属性
- 可学习的术法类型
- 境界突破方式
- 战斗风格

### 2.2 功法等阶

| 等阶 | 名称 | 修炼速度 | 属性加成 | 可学技能 |
|------|------|---------|---------|---------|
| 黄阶下品 | 基础功法 | ×1.0 | +0% | 黄阶术法 |
| 黄阶中品 | 入门功法 | ×1.2 | +5% | 黄阶术法 |
| 黄阶上品 | 优良功法 | ×1.5 | +10% | 黄阶术法+部分玄阶 |
| 玄阶下品 | 精品功法 | ×2.0 | +20% | 玄阶术法 |
| 玄阶中品 | 上等功法 | ×2.5 | +30% | 玄阶术法 |
| 玄阶上品 | 顶级功法 | ×3.0 | +40% | 玄阶术法+部分地阶 |
| 地阶下品 | 传承功法 | ×4.0 | +60% | 地阶术法+神通 |
| 地阶中品 | 宗门核心功法 | ×5.0 | +80% | 地阶术法+神通 |
| 地阶上品 | 绝世功法 | ×6.0 | +100% | 地阶术法+神通 |
| 天阶 | 天道功法 | ×8.0 | +150% | 天阶术法+大神通 |

### 2.3 功法分类

#### 五行功法

**金属性功法** - 剑修、器修
- 代表：《金刚不灭诀》《万剑归宗》
- 特点：攻击力强，破坏力大
- 适合：剑修、器修
- 技能倾向：剑气、金属性攻击

**木属性功法** - 医修、毒修
- 代表：《青木长生诀》《万毒真经》
- 特点：恢复能力强，持续伤害
- 适合：医修、毒修
- 技能倾向：治疗、毒素、生命力

**水属性功法** - 法修
- 代表：《沧海无量诀》《玄水真经》
- 特点：真元深厚，法术威力大
- 适合：法修
- 技能倾向：水法、冰法、控制

**火属性功法** - 炼丹师、爆发型
- 代表：《焚天烈焰诀》《九阳神功》
- 特点：爆发力强，伤害高
- 适合：炼丹师、攻击型修士
- 技能倾向：火焰攻击、爆炸

**土属性功法** - 体修、防御型
- 代表：《大地镇岳诀》《玄武神甲功》
- 特点：防御力强，气血深厚
- 适合：体修、防御型
- 技能倾向：护盾、防御、生存

#### 阴阳功法

**阳属性功法**
- 代表：《纯阳无极功》《太阳真经》
- 特点：至刚至阳，克制邪祟
- 技能倾向：光明系、驱邪

**阴属性功法**
- 代表：《太阴玄功》《鬼修真经》
- 特点：阴冷诡异，精神攻击
- 技能倾向：鬼修、精神攻击

#### 特殊功法

**雷属性功法**
- 代表：《九天应元雷法》《紫霄神雷诀》
- 特点：威力巨大，速度快
- 技能倾向：雷电攻击、速度

**剑修功法**
- 代表：《御剑真诀》《万剑归宗》
- 特点：剑道专精
- 技能倾向：剑气、御剑飞行

**体修功法**
- 代表：《金刚不坏神功》《霸体诀》
- 特点：肉身强悍
- 技能倾向：近战、防御、爆发

**魔修功法**
- 代表：《天魔策》《血神经》
- 特点：提升快但有副作用
- 技能倾向：献祭、吸血、邪术

### 2.4 功法学习与切换

#### 学习条件
- **境界要求**: 达到对应境界
- **灵根匹配**: 功法属性与灵根匹配，效果更好
- **师承**: 某些功法需要拜师或加入门派
- **悟性要求**: 高等级功法需要高悟性

#### 功法切换
- 可以切换功法，但会有损失
- 切换同属性功法：保留80%修为
- 切换不同属性功法：保留50%修为
- 切换对立属性功法：保留30%修为

---

## 三、术法系统（基础技能）

### 3.1 术法等级

术法按修炼程度分为：
```
入门 → 小成 → 大成 → 圆满 → 大圆满
```

每个阶段威力提升20%

### 3.2 术法分类

#### 黄阶术法（基础）

**火球术** 🔥
- 等阶：黄阶下品
- 类型：攻击/火系
- 消耗：10真元
- 冷却：2秒
- 效果：发射火球，造成10%法术攻击的火焰伤害
- 学习条件：练气3层

**冰箭术** ❄️
- 等阶：黄阶中品
- 类型：攻击/控制/冰系
- 消耗：15真元
- 冷却：3秒
- 效果：发射冰箭，造成12%法术攻击的冰霜伤害，30%概率冰冻2秒
- 学习条件：练气5层

**金光护体** 🛡️
- 等阶：黄阶上品
- 类型：防御/金系
- 消耗：20真元
- 冷却：30秒
- 效果：产生金色护盾，吸收20点伤害，持续10秒
- 学习条件：练气7层

**疾风步** 💨
- 等阶：黄阶中品
- 类型：位移/风系
- 消耗：15真元
- 冷却：10秒
- 效果：瞬间移动10米，持续3秒内移动速度+50%
- 学习条件：练气6层

#### 玄阶术法（进阶）

**火龙术** 🐉
- 等阶：玄阶中品
- 类型：攻击/火系
- 消耗：50真元
- 冷却：8秒
- 效果：召唤火龙冲击，造成30%法术攻击的火焰伤害，对路径上所有敌人造成伤害
- 学习条件：筑基期，火球术大成

**寒冰领域** 🧊
- 等阶：玄阶上品
- 类型：控制/冰系
- 消耗：80真元
- 冷却：20秒
- 效果：以自身为中心展开寒冰领域（15米），敌人移动速度-50%，每秒造成5点冰霜伤害，持续8秒
- 学习条件：筑基后期，冰箭术圆满

**剑气纵横** ⚔️
- 等阶：玄阶上品
- 类型：攻击/金系
- 消耗：60真元
- 冷却：5秒
- 效果：挥出剑气斩击，造成25%物理攻击的伤害，可同时攻击5个敌人
- 学习条件：筑基期，剑修

**土盾术** 🪨
- 等阶：玄阶中品
- 类型：防御/土系
- 消耗：40真元
- 冷却：15秒
- 效果：从地面升起土盾，吸收50点伤害或持续15秒
- 学习条件：筑基期

#### 地阶术法（高级）

**五雷轰顶** ⚡
- 等阶：地阶下品
- 类型：攻击/雷系
- 消耗：200真元
- 冷却：30秒
- 效果：召唤五道天雷轰击，每道造成50%法术攻击的雷电伤害，50%概率麻痹3秒
- 学习条件：金丹期，雷法修炼

**万剑归宗** ⚔️⚔️⚔️
- 等阶：地阶上品
- 类型：攻击/金系
- 消耗：500真元
- 冷却：60秒
- 效果：召唤万剑齐发，对范围内所有敌人造成100%物理攻击的伤害
- 学习条件：元婴期，剑修，剑气纵横大圆满

**不死之身** 💀
- 等阶：地阶中品
- 类型：防御/体修
- 消耗：300真元
- 冷却：120秒
- 效果：10秒内免疫致死伤害，气血降至1点后立即恢复50%气血（仅一次）
- 学习条件：金丹期，体修

**瞬息千里** 🌪️
- 等阶：地阶下品
- 类型：位移/空间
- 消耗：150真元
- 冷却：60秒
- 效果：瞬移至100米内任意可见位置
- 学习条件：金丹期，空间法则入门

### 3.3 术法学习方式

#### 学习途径
- **师门传授**: 加入门派后学习门派术法
- **功法典籍**: 购买或获得术法秘籍
- **任务奖励**: 完成任务获得
- **机缘获得**: 洞府探索、秘境试炼
- **自行推演**: 高悟性修士可自创术法

#### 修炼提升
- **使用修炼**: 使用术法增加熟练度
- **专注修炼**: 消耗时间和灵石专门修炼
- **顿悟**: 低概率直接大幅提升
- **高人指点**: 找前辈指点，快速提升

---

## 四、神通系统（大招）

### 4.1 神通概念

**神通**是修士达到一定境界后领悟的强大能力，威力远超普通术法。

### 4.2 神通分类

#### 攻击类神通

**大灭神光**
- 等阶：神通级
- 类型：攻击/光系
- 消耗：1000真元
- 冷却：300秒
- 效果：释放毁灭神光，对前方直线所有敌人造成200%法术攻击的伤害，无视50%防御
- 领悟条件：化神期，光属性功法

**血海滔天**
- 等阶：神通级
- 类型：攻击/血系
- 消耗：800真元+10%当前气血
- 冷却：180秒
- 效果：召唤血海淹没敌人，造成150%法术攻击的伤害，并吸取伤害的30%转化为气血
- 领悟条件：元婴期，血修功法

#### 防御类神通

**金刚不坏**
- 等阶：神通级
- 类型：防御/体修
- 消耗：500真元
- 冷却：180秒
- 效果：15秒内物理防御+500%，免疫控制效果
- 领悟条件：元婴期，体修金刚系功法

**虚空遁形**
- 等阶：神通级
- 类型：防御/空间
- 消耗：300真元
- 冷却：120秒
- 效果：进入虚空，10秒内无敌且无法行动，可提前取消
- 领悟条件：化神期，空间法则小成

#### 控制类神通

**天地禁锢**
- 等阶：神通级
- 类型：控制/空间
- 消耗：800真元
- 冷却：200秒
- 效果：禁锢30米范围内所有敌人，持续5秒，期间无法移动或使用技能
- 领悟条件：化神期，空间法则大成

**心魔幻境**
- 等阶：神通级
- 类型：控制/精神
- 消耗：600真元
- 冷却：150秒
- 效果：对单一敌人释放心魔，陷入幻境8秒，期间无法分辨敌我
- 领悟条件：元婴期，精神修炼

#### 辅助类神通

**涅槃重生**
- 等阶：神通级
- 类型：辅助/治疗
- 消耗：全部真元
- 冷却：一天一次
- 效果：死亡后立即复活，恢复50%气血和真元
- 领悟条件：化神期，凤凰血脉或特殊机缘

**法天象地**
- 等阶：神通级
- 类型：辅助/变身
- 消耗：500真元/秒
- 冷却：300秒
- 效果：化身巨人，体型增大10倍，全属性+200%，持续60秒或真元耗尽
- 领悟条件：化神期，体修

### 4.3 神通领悟

#### 领悟方式
- **境界突破领悟**: 突破到化神期等高境界时有概率领悟
- **功法附带**: 某些高级功法修炼到一定程度自带神通
- **传承获得**: 获得前辈传承，直接学会神通
- **自行感悟**: 感悟天地大道，创造神通
- **机缘获得**: 特殊机缘获得神通秘籍

#### 领悟条件
- 境界：至少元婴期
- 悟性：≥15
- 功法：相关功法大圆满
- 法则：对应法则入门

---

## 五、技能搭配系统

### 5.1 技能栏设计

玩家可装备的技能：
```
【主动技能栏】
1. 技能槽1 - 基础攻击术法
2. 技能槽2 - 防御/位移术法
3. 技能槽3 - 控制/辅助术法
4. 技能槽4 - 高级术法
5. 技能槽5 - 神通（大招）

【被动技能栏】
1. 被动槽1 - 属性提升类
2. 被动槽2 - 战斗辅助类
3. 被动槽3 - 特殊效果类
```

### 5.2 连招系统

#### 法修连招示例
```
【爆发连招】
火球术 → 火龙术 → 五雷轰顶
(快速输出，适合击杀脆皮)

【控制连招】
寒冰领域 → 冰箭术 → 火球术
(先控制再输出)

【风筝连招】
疾风步（拉开距离） → 火球术 × 3 → 再次疾风步
(适合对付近战)
```

#### 剑修连招示例
```
【爆发连招】
御剑飞行（接近） → 剑气纵横 → 万剑归宗
(近身爆发，秒杀敌人)

【游走连招】
剑气纵横（远程） → 疾风步（接近） → 普通攻击 × 3 → 剑气纵横
(灵活游走)
```

#### 体修连招示例
```
【坦克连招】
金刚不坏 → 冲锋（接近） → 普通攻击 × 5 → 不死之身
(抗伤害输出)
```

### 5.3 技能相克

- 火克金，金克木，木克土，土克水，水克火
- 光克暗，暗克光
- 雷法对金属防御特效
- 冰法对水法有减免

---

## 六、被动技能系统

### 6.1 被动技能类型

#### 属性提升类

**灵根强化**
- 效果：根据灵根属性，对应元素伤害+20%
- 获得：天生或特殊机缘

**体质强化**
- 效果：最大气血+30%，气血恢复+50%
- 获得：体修功法附带

**真元精炼**
- 效果：最大真元+25%，真元恢复+30%
- 获得：功法修炼至大成

#### 战斗辅助类

**反击**
- 效果：受到近战攻击时，20%概率反击，造成5%攻击力的伤害
- 获得：武技修炼

**法术穿透**
- 效果：法术攻击无视目标15%法术防御
- 获得：法修天赋或特殊功法

**暴击精通**
- 效果：暴击率+10%，暴击伤害+30%
- 获得：剑修天赋

**生命汲取**
- 效果：造成伤害的10%转化为生命值
- 获得：血修功法或魔道功法

#### 特殊效果类

**真元回馈**
- 效果：击杀敌人后恢复10%真元
- 获得：特殊功法

**不死血脉**
- 效果：致死伤害触发时，10%概率免疫死亡并恢复50%气血（每天一次）
- 获得：特殊血脉或机缘

**顿悟契机**
- 效果：战斗中有小概率触发顿悟，技能熟练度大幅提升
- 获得：高悟性（≥18）

**灵气吸收**
- 效果：站立不动时，每秒恢复5%真元
- 获得：特殊功法

### 6.2 被动技能获取

- 功法附带
- 特殊体质天生
- 技能修炼至圆满解锁
- 机缘获得
- 血脉觉醒

---

## 七、技能升级系统

### 7.1 技能熟练度

#### 熟练度等级
```
入门（1-99）
	↓ 使用100次或修炼1小时
小成（100-499）
	↓ 使用500次或修炼10小时
大成（500-1999）
	↓ 使用2000次或修炼50小时
圆满（2000-4999）
	↓ 使用5000次或修炼200小时或顿悟
大圆满（5000+）
```

#### 熟练度提升方式
- **实战使用**: 使用技能+1熟练度
- **专注修炼**: 消耗时间和灵石修炼，+10熟练度/小时
- **高人指点**: 消耗灵石请教前辈，+100熟练度
- **顿悟**: 随机触发，直接提升一个阶段

### 7.2 技能升级效果

每提升一个阶段：
- 威力+20%
- 消耗-10%
- 冷却-10%
- 可能解锁新效果

**示例：火球术的成长**
```
入门：造成10%法术攻击伤害
小成：造成12%法术攻击伤害，消耗-10%
大成：造成14%法术攻击伤害，消耗-20%，冷却-10%
圆满：造成17%法术攻击伤害，消耗-30%，冷却-20%，10%概率造成灼烧效果
大圆满：造成20%法术攻击伤害，消耗-40%，冷却-30%，20%概率造成灼烧效果，火球变大
```

---

## 八、法则领悟系统

### 8.1 法则概念

修士达到化神期后，开始领悟天地法则。

### 8.2 法则类型

#### 基础法则（五行）
- **金之法则**: 锋锐、破甲
- **木之法则**: 生命、恢复
- **水之法则**: 流动、包容
- **火之法则**: 爆炸、焚烧
- **土之法则**: 厚重、防御

#### 高级法则
- **空间法则**: 传送、空间切割
- **时间法则**: 时停、加速、减速
- **生命法则**: 治疗、复活
- **死亡法则**: 即死、亡灵
- **雷之法则**: 速度、破坏

#### 顶级法则
- **阴阳法则**: 转化、平衡
- **因果法则**: 命运、业力
- **混沌法则**: 创造、毁灭

### 8.3 法则等级

```
未入门（0%）
入门（1%-19%）- 技能威力+10%
小成（20%-39%）- 技能威力+25%，解锁法则技能
大成（40%-59%）- 技能威力+45%，法则技能强化
圆满（60%-79%）- 技能威力+70%，可融合法则
大圆满（80%-99%）- 技能威力+100%，法则领域
圆满（100%）- 合道，成仙
```

### 8.4 法则领悟方式

- **战斗感悟**: 使用对应属性技能有概率感悟
- **静修领悟**: 闭关专门领悟法则
- **天地异象**: 观看天地异象，领悟法则
- **法则碎片**: 使用法则碎片直接提升
- **传承获得**: 获得前辈法则传承

---

## 九、技能组合与套路

### 9.1 流派套路

#### 剑修流派
**核心技能**:
- 御剑术
- 剑气纵横
- 万剑归宗
- 人剑合一（神通）

**特点**: 高爆发，灵活，单体伤害强

**打法**: 快速接近 → 爆发秒杀 → 御剑离开

#### 法修流派
**核心技能**:
- 五行术法（火球、冰箭、雷击等）
- 领域类技能（寒冰领域、火海等）
- 禁咒（五雷轰顶、陨石术等）

**特点**: 范围伤害，控场能力强

**打法**: 保持距离 → 控制敌人 → 范围输出

#### 体修流派
**核心技能**:
- 金刚不坏
- 霸体
- 不死之身
- 法天象地（神通）

**特点**: 高生存，近战输出

**打法**: 冲进人群 → 开启防御 → 持续输出

#### 鬼修流派
**核心技能**:
- 招魂术
- 鬼物召唤
- 心魔幻境
- 万鬼噬魂（神通）

**特点**: 召唤物，精神攻击

**打法**: 召唤鬼物 → 精神控制 → 鬼物围攻

### 9.2 PVP组合技

#### 控制流
```
寒冰领域（减速） → 冰箭术（冰冻） → 天地禁锢（定身） → 五雷轰顶（爆发）
```

#### 风筝流
```
疾风步（拉开） → 火球术 → 火球术 → 再次疾风步 → 重复
```

#### 秒杀流
```
虚空遁形（接近） → 万剑归宗（爆发） → 剑气纵横（补刀）
```

---

## 十、数据结构设计

### 10.1 技能数据类

```gdscript
class_name 技能数据

# 基础信息
var 技能ID: String
var 技能名称: String
var 技能描述: String
var 技能图标: Texture

# 分类
var 技能类型: String  # "攻击"/"防御"/"辅助"/"控制"/"位移"/"召唤"
var 技能属性: String  # "金"/"木"/"水"/"火"/"土"/"雷"/"冰"等
var 主被动: String    # "主动"/"被动"/"切换"
var 技能等阶: String  # "黄阶"/"玄阶"/"地阶"/"天阶"/"神通"

# 学习条件
var 需求境界: int = 1
var 需求功法: String = ""
var 需求前置技能: Array = []  # 前置技能ID列表
var 需求悟性: int = 0

# 技能消耗
var 消耗真元: int = 0
var 消耗气血: int = 0
var 冷却时间: float = 0.0  # 秒

# 技能效果
var 基础伤害: int = 0
var 伤害系数: float = 1.0  # 攻击力倍率
var 效果范围: float = 0.0  # 米
var 效果时间: float = 0.0  # 秒
var 特殊效果: Array = []   # 特殊效果列表

# 技能熟练度
var 当前熟练度: int = 0
var 熟练度等级: String = "入门"  # "入门"/"小成"/"大成"/"圆满"/"大圆满"

# 技能等级加成
func 获取熟练度加成() -> float:
	match 熟练度等级:
		"入门": return 1.0
		"小成": return 1.2
		"大成": return 1.44
		"圆满": return 1.72
		"大圆满": return 2.07
		_: return 1.0

# 计算最终伤害
func 计算伤害(攻击力: int, 法则加成: float = 0.0) -> int:
	var 基础 = 基础伤害 + 攻击力 * 伤害系数
	var 熟练度倍率 = 获取熟练度加成()
	var 法则倍率 = 1.0 + 法则加成
	return int(基础 * 熟练度倍率 * 法则倍率)

# 增加熟练度
func 增加熟练度(数值: int):
	当前熟练度 += 数值
	更新熟练度等级()

func 更新熟练度等级():
	if 当前熟练度 >= 5000:
		熟练度等级 = "大圆满"
	elif 当前熟练度 >= 2000:
		熟练度等级 = "圆满"
	elif 当前熟练度 >= 500:
		熟练度等级 = "大成"
	elif 当前熟练度 >= 100:
		熟练度等级 = "小成"
	else:
		熟练度等级 = "入门"
```

### 10.2 功法数据类

```gdscript
class_name 功法数据

# 基础信息
var 功法ID: String
var 功法名称: String
var 功法描述: String
var 功法图标: Texture

# 等阶
var 功法等阶: String  # "黄阶"/"玄阶"/"地阶"/"天阶"
var 品质: String      # "下品"/"中品"/"上品"

# 属性
var 功法属性: String  # "金"/"木"/"水"/"火"/"土"/"阴"/"阳"等
var 修炼方向: String  # "剑修"/"法修"/"体修"/"鬼修"等

# 修炼加成
var 修炼速度倍率: float = 1.0
var 属性加成: Dictionary = {
	"全属性": 0,
	"物理攻击": 0,
	"法术攻击": 0,
	"防御": 0,
	"气血": 0,
	"真元": 0
}

# 可学习技能
var 可学技能列表: Array = []  # 技能ID列表

# 附带神通
var 附带神通: String = ""  # 神通ID

# 修炼进度
var 当前修为: int = 0
var 需要修为: int = 100000
var 修炼等级: String = "入门"

func 获取修炼进度() -> float:
	return float(当前修为) / 需要修为

func 增加修为(数值: int):
	当前修为 += int(数值 * 修炼速度倍率)
	if 当前修为 >= 需要修为:
		提升等级()

func 提升等级():
	当前修为 -= 需要修为
	match 修炼等级:
		"入门": 修炼等级 = "小成"
		"小成": 修炼等级 = "大成"
		"大成": 修炼等级 = "圆满"
		"圆满": 修炼等级 = "大圆满"
	需要修为 *= 2  # 下一级需要加倍修为
```

### 10.3 技能管理器

```gdscript
class_name 技能管理器

# 已学技能
var 已学技能: Dictionary = {}  # {技能ID: 技能数据}

# 装备的技能
var 装备技能: Dictionary = {
	"技能槽1": null,
	"技能槽2": null,
	"技能槽3": null,
	"技能槽4": null,
	"技能槽5": null,
}

# 被动技能
var 装备被动: Dictionary = {
	"被动槽1": null,
	"被动槽2": null,
	"被动槽3": null,
}

# 当前功法
var 当前功法: 功法数据 = null

# 技能冷却记录
var 技能冷却: Dictionary = {}  # {技能ID: 剩余冷却时间}

signal 技能释放(技能ID)
signal 技能冷却完成(技能ID)
signal 技能学会(技能ID)

func _process(delta):
	更新技能冷却(delta)

func 更新技能冷却(delta: float):
	"""更新所有技能冷却"""
	var 完成列表 = []
	for 技能ID in 技能冷却:
		技能冷却[技能ID] -= delta
		if 技能冷却[技能ID] <= 0:
			完成列表.append(技能ID)

	for 技能ID in 完成列表:
		技能冷却.erase(技能ID)
		技能冷却完成.emit(技能ID)

func 学习技能(技能: 技能数据) -> bool:
	"""学习新技能"""
	# 检查条件
	if not 检查学习条件(技能):
		return false

	# 学习技能
	已学技能[技能.技能ID] = 技能
	技能学会.emit(技能.技能ID)
	return true

func 检查学习条件(技能: 技能数据) -> bool:
	"""检查是否满足学习条件"""
	# 检查境界
	var 玩家境界 = 玩家.属性管理器.境界系统.获取境界等级()
	if 玩家境界 < 技能.需求境界:
		return false

	# 检查功法
	if 技能.需求功法 != "" and (当前功法 == null or 当前功法.功法ID != 技能.需求功法):
		return false

	# 检查前置技能
	for 前置技能ID in 技能.需求前置技能:
		if not 已学技能.has(前置技能ID):
			return false
		var 前置技能 = 已学技能[前置技能ID]
		if 前置技能.熟练度等级 != "大成" and 前置技能.熟练度等级 != "圆满" and 前置技能.熟练度等级 != "大圆满":
			return false

	# 检查悟性
	var 悟性 = 玩家.属性管理器.基础属性.获取悟性()
	if 悟性 < 技能.需求悟性:
		return false

	return true

func 释放技能(技能槽: String) -> bool:
	"""释放技能"""
	var 技能 = 装备技能.get(技能槽)
	if not 技能:
		return false

	# 检查冷却
	if 技能冷却.has(技能.技能ID):
		return false

	# 检查真元
	var 当前真元 = 玩家.属性管理器.战斗属性.当前真元
	if 当前真元 < 技能.消耗真元:
		return false

	# 消耗真元
	玩家.属性管理器.战斗属性.减少真元(技能.消耗真元)

	# 进入冷却
	技能冷却[技能.技能ID] = 技能.冷却时间

	# 增加熟练度
	技能.增加熟练度(1)

	# 释放技能
	技能释放.emit(技能.技能ID)
	执行技能效果(技能)

	return true

func 执行技能效果(技能: 技能数据):
	"""执行技能具体效果"""
	# 根据技能类型执行不同效果
	match 技能.技能类型:
		"攻击":
			执行攻击技能(技能)
		"防御":
			执行防御技能(技能)
		"辅助":
			执行辅助技能(技能)
		# ... 其他类型

func 执行攻击技能(技能: 技能数据):
	"""执行攻击技能"""
	var 攻击力 = 玩家.属性管理器.战斗属性.获取法术攻击()
	var 法则加成 = 获取法则加成(技能.技能属性)
	var 伤害 = 技能.计算伤害(攻击力, 法则加成)

	# 对目标造成伤害
	# ... 具体战斗逻辑

func 获取法则加成(属性: String) -> float:
	"""获取法则加成"""
	# 根据玩家领悟的法则返回加成
	return 0.0  # 临时返回

func 装备技能到槽位(技能ID: String, 技能槽: String) -> bool:
	"""将技能装备到技能槽"""
	if not 已学技能.has(技能ID):
		return false

	装备技能[技能槽] = 已学技能[技能ID]
	return true

func 卸下技能(技能槽: String):
	"""卸下技能槽的技能"""
	装备技能[技能槽] = null

func 修炼功法(时间: float):
	"""修炼功法，增加修为"""
	if not 当前功法:
		return

	var 修为增加 = int(时间 * 100)  # 每小时100修为
	当前功法.增加修为(修为增加)

func 切换功法(新功法: 功法数据):
	"""切换功法"""
	if 当前功法:
		# 计算保留的修为
		var 保留比例 = 计算功法切换保留比例(当前功法, 新功法)
		var 保留修为 = int(当前功法.当前修为 * 保留比例)
		新功法.当前修为 = 保留修为

	当前功法 = 新功法

func 计算功法切换保留比例(旧功法: 功法数据, 新功法: 功法数据) -> float:
	"""计算切换功法时修为保留比例"""
	if 旧功法.功法属性 == 新功法.功法属性:
		return 0.8  # 同属性80%
	elif 是否相克(旧功法.功法属性, 新功法.功法属性):
		return 0.3  # 相克30%
	else:
		return 0.5  # 其他50%

func 是否相克(属性1: String, 属性2: String) -> bool:
	"""判断两个属性是否相克"""
	var 相克表 = {
		"金": "木",
		"木": "土",
		"土": "水",
		"水": "火",
		"火": "金"
	}
	return 相克表.get(属性1) == 属性2 or 相克表.get(属性2) == 属性1
```

---

## 十一、实现建议

### 11.1 实现优先级

#### 第一阶段（核心功能）
1. 技能数据结构
2. 功法系统基础
3. 10-20个基础术法
4. 技能释放机制
5. 技能冷却系统

#### 第二阶段（扩展功能）
1. 技能熟练度系统
2. 功法切换系统
3. 30-50个进阶术法
4. 被动技能系统
5. 技能组合效果

#### 第三阶段（高级功能）
1. 神通系统
2. 法则领悟系统
3. 自创技能系统
4. 技能特效动画
5. 技能平衡调整

### 11.2 文件结构建议

```
脚本/核心系统/技能系统/
├── 技能管理器.gd
├── 技能数据.gd
├── 功法数据.gd
├── 神通数据.gd
├── 法则系统.gd
└── 技能效果处理器.gd

数据/技能配置/
├── 功法库.json          # 所有功法配置
├── 术法库.json          # 所有术法配置
├── 神通库.json          # 所有神通配置
├── 被动技能库.json      # 被动技能配置
└── 法则配置.json        # 法则相关配置
```

### 11.3 与现有系统集成

- **属性系统**: 功法提供属性加成
- **装备系统**: 装备可能增加技能等级或解锁技能
- **门派系统**: 门派提供专属功法和技能
- **战斗系统**: 技能是战斗的核心
- **境界系统**: 境界决定可学习的技能等级

---

## 十二、平衡性建议

### 12.1 技能平衡

- 低级技能应该易学易用，高级技能难学难精
- 每个流派应该有独特优势，避免一家独大
- PVE和PVP技能效果应该有区分
- 控制技能不应过强，避免无限控制

### 12.2 功法平衡

- 高等级功法修炼速度快，但获取难度高
- 功法切换有代价，避免频繁切换
- 每种功法都应该有其适用场景

### 12.3 神通平衡

- 神通威力巨大，但冷却时间长
- 神通应该是战斗的决胜技，而非常规手段
- 神通获取应该有难度，不能泛滥

---

**版本**: v1.0
**设计日期**: 2025-01-10
**参考来源**:
- 凡人修仙传（小说）- 功法体系
- 了不起的修仙模拟器、鬼谷八荒（游戏）- 技能系统
- 传统修仙设定 - 术法、神通分类
