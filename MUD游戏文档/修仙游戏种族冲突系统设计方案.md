# 修仙游戏种族冲突系统设计方案

> **重要**: 本文档定义种族间冲突与共存系统,增强世界观真实性和代入感
>
> **依赖系统**: 种族系统、国家系统、门派系统、NPC智能系统、声望系统
>
> **参考标准**: 详见《【重要】文档统一标准.md》

---

## 一、系统概述

### 0.11000000000000001 设计理念

**核心目标**:
- 不同种族有独特文化和立场
- 种族间既有冲突也有合作
- 玩家行为影响种族关系
- 避免简单的种族歧视,强调文化差异

**参考作品**:
- 《魔兽世界》(联盟与部落)
- 《龙族》(混血种冲突)
- 《凡人修仙传》(人族、妖族、魔族)
- 《遮天》(各族争霸)

### 0.12 种族分类

根据《修仙游戏种族系统设计方案.md》,主要种族包括:

| 种族 | 特性 | 主要势力范围 | 与人族关系 |
|------|------|-------------|-----------|
| **人族** | 繁衍快、适应强 | 东方大陆7% | - |
| **妖族** | 体魄强、寿命长 | 十万大山、南荒 | 敌对/中立 |
| **魔族** | 魔功强、嗜杀戮 | 北域魔土 | 敌对 |
| **龙族** | 天赋异禀、稀少 | 东海龙宫 | 中立/傲慢 |
| **凤族** | 涅槃再生、高贵 | 南明火山 | 中立 |
| **巫族** | 肉身无双、不修元神 | 西荒 | 中立 |
| **鬼族** | 亡灵、阴邪 | 幽冥鬼域 | 敌对 |
| **精怪** | 草木成精、弱小 | 各地散居 | 友好 |
| **半妖** | 人妖混血、不被接纳 | 边境/隐居 | 复杂 |

---

## 二、种族关系系统

### 0.21000000000000002 关系值机制

```python
种族关系值 = -10(血海深仇) ~ +10(亲密盟友)

关系等级划分:
+8 ~ +10: 血盟 (共同防御、通婚、资源共享)
+5 ~ +7.9: 友好 (贸易优惠、互助)
+2 ~ +4.9: 中立偏好 (正常贸易)
 -1.9 ~ +1.9: 中立 (有限往来)
-2 ~ -4.9: 警惕 (边境紧张)
-5 ~ -7.9: 敌对 (小规模冲突)
-8 ~ -10: 世仇 (种族战争)
```

### 0.22000000000000003 初始关系设定

```python
# 人族视角
人族关系表 = {
    "妖族": -3,    # 历史冲突,互相猎杀
    "魔族": -8,    # 天然宿敌
    "龙族": +1,    # 有过合作,但龙族傲慢
    "凤族": +2,    # 凤族相对友善
    "巫族": -1,    # 文化差异大
    "鬼族": -6,    # 鬼族侵扰人间
    "精怪": +4,    # 弱小无害
    "半妖": -2,    # 歧视混血
}

# 妖族视角
妖族关系表 = {
    "人族": -3,    # 人族猎杀妖兽
    "魔族": -2,    # 竞争关系
    "龙族": -4,    # 龙族自视高贵,歧视妖族
    "巫族": +3,    # 都是肉身修炼
    "鬼族": -5,    # 鬼族吞噬妖魂
    "精怪": +5,    # 同类
    "半妖": +6,    # 保护混血后代
}

# 魔族视角
魔族关系表 = {
    "人族": -8,    # 正邪不两立
    "妖族": -2,    # 可能合作
    "龙族": -7,    # 龙族剿杀魔族
    "鬼族": +4,    # 同属阴邪
}
```

---

## 三、种族冲突类型

### 0.31 领土冲突

#### 十万大山边境(人族vs妖族)

**冲突起因**:
- 人族向南扩张,砍伐森林建立城镇
- 妖族领地被侵占,生存空间压缩
- 双方猎杀对方(人族猎妖,妖族食人)

**冲突表现**:
```python
【边境事件】
- 人类村庄被妖兽袭击(每月0.5-1次)
- 人族猎妖队深入妖族领地(每月1-2次)
- 边境贸易站劫掠(双方都有)
- 偶尔的小规模战斗(百人vs数十妖)

【升级路径】
0.1. 个别冲突 → 0.2. 村镇守备战 → 0.3. 郡级战役 → 0.4. 种族战争
```

**玩家介入**:
```gdscript
人族玩家:
- 任务: 清剿妖兽保卫村庄
- 奖励: 妖丹、皮毛、人族声望+1
- 后果: 妖族声望-1.5

妖族玩家:
- 任务: 驱逐人类伐木队
- 奖励: 人类物资、妖族声望+1
- 后果: 人族声望-1.5

中立选择:
- 调查真相: 发现是魔族挑唆
- 调解: 智力+外交检定
- 成功: 双方声望+0.5, 获得稀有奖励
```

#### 北域魔土(所有种族vs魔族)

**冲突起因**:
- 魔族修炼需要吞噬生灵
- 魔族定期南侵劫掠人口
- 正道联盟定期北伐

**冲突烈度**: 最高

```python
魔族入侵(每1年一次):
- 魔族军团 0.5万-1.5万
- 正道联军(人+妖+龙) 2万-5万
- 持续时间: 0.1-0.3年
- 伤亡: 双方各 3-6%

结果:
- 魔族通常被击退
- 偶尔魔族大胜,占领人族领土数年
- 每次战争后都有大量难民/孤儿
```

### 0.32 资源冲突

#### 灵脉争夺

```python
【事件】: 发现新灵脉

种族优先级:
0.1. 龙族: 认为所有龙脉归龙族(霸道)
0.2. 人族门派: 先到先得
0.3. 妖族: 可能群起争夺
0.4. 魔族: 直接杀人夺宝

冲突流程:
0.1. 发现阶段: 各方探子发现,情报泄露
0.2. 谈判阶段: 外交斡旋(可能)
0.3. 小队争夺: 各派精英小队(0.5-2人)
0.4. 大军压境: 调动军队(100-1000人)
0.5. 联盟介入: 各种族大佬出面

玩家参与:
- 探索: 有机会第一个发现
- 小队战: 作为精英参战
- 外交: 代表势力谈判
- 暗杀: 刺杀对方关键人物
```

### 0.32999999999999996 文化冲突

#### 人族vs半妖

**冲突本质**: 种族歧视与认同问题

```gdscript
【社会现象】
人族态度:
- 主流: 歧视,视为异类
- 开明派: 接纳,但要求隐藏妖族血统
- 极端派: 格杀勿论

半妖处境:
- 无法融入人族社会(被歧视)
- 无法融入妖族社会(被视为叛徒)
- 只能在边缘地带生存
- 互相抱团形成半妖聚居地

冲突事件:
0.1. 半妖被发现 → 村民私刑
0.2. 半妖复仇 → 屠村事件
0.3. 半妖起义 → 建立独立势力
0.4. 人妖恋情 → 双方家族血仇
```

**玩家选择**:
```python
纯血人族玩家:
0.1. 歧视半妖 → 人族保守派声望+2, 半妖声望-5
0.2. 包容半妖 → 半妖声望+3, 人族保守派声望-1
0.3. 暗中帮助 → 半妖感激, 特殊奖励

半妖玩家:
0.1. 隐藏身份 → 可混入人族,但随时可能暴露
0.2. 公开身份 → 受歧视, 但活得坦荡
0.3. 加入半妖组织 → 获得庇护,但与人族敌对

剧情分支:
- 拯救被追杀的半妖儿童
- 揭露半妖屠村真相(实为魔族嫁祸)
- 促成人妖通婚合法化(超高难度)
```

#### 龙族傲慢

**冲突本质**: 强者歧视弱者

```python
龙族态度:
- 对人族: "蝼蚁", 只有化神期以上才能对话
- 对妖族: "低等种族", 随意奴役
- 对其他龙族: 严格血统等级

人族/妖族反应:
- 屈辱忍受(实力不足)
- 暗中仇恨(积累矛盾)
- 个别强者挑战(罕见)

冲突事件:
0.1. 龙族强征妖族为奴
0.2. 龙族随意破坏人类城镇(觉得好玩)
0.3. 龙族抢夺宝物(认为凡人不配拥有)

玩家遭遇:
场景: 龙族少年看上你的法宝
选择:
0.1. 献上 → 保命, 道心受损
0.2. 拒绝 → 被打成重伤,法宝被抢
0.3. 反抗 → 9.9%死亡, 0.1%龙族欣赏收为仆从
0.4. 求助大能 → 需要足够背景

长期影响:
- 仇恨种子,未来可能复仇
- 龙族也有开明派,可能成为盟友
```

---

## 四、种族战争系统

### 0.41 种族战争与国家战争的区别

| 对比项 | 国家战争 | 种族战争 |
|-------|---------|---------|
| **参战方** | 国家 | 整个种族 |
| **规模** | 1万-3万 | 5万-50万 |
| **持续时间** | 0.1-0.3年 | 1-10年 |
| **结束条件** | 割地赔款 | 种族灭绝/屈服 |
| **修仙者参与** | 受限 | 全力参与 |
| **玩家影响** | 较大 | 较小(太宏大) |

### 0.42000000000000004 历史种族战争

**第一次人妖大战**(历史事件,游戏开始前500年)

```gdscript
起因: 妖族占据东方大陆,人族被压迫
经过:
- 人族修仙者崛起
- 持续50年战争
- 人族联合龙族、凤族
- 妖族内部分裂(部分妖族倒戈)

结果:
- 妖族战败,退守十万大山、南荒
- 人族成为大陆主导种族
- 遗留仇恨至今

影响:
- 人族歧视妖族
- 妖族仇视人族
- 半妖群体产生
```

**正魔大战**(历史事件,游戏开始前100年)

```gdscript
起因: 魔族南侵,屠杀数百万生灵
经过:
- 人族+妖族+龙族联盟
- 正道修仙者全力反击
- 持续30年
- 魔族差点灭族

结果:
- 魔族被封印于北域魔土
- 设立封印大阵(每百年需加固)
- 魔族元气大伤

现状:
- 魔族逐渐恢复实力
- 封印逐渐削弱
- 可能再次爆发大战
```

### 0.43 当前种族紧张局势

```python
【潜在火药桶】

0.1. 魔族复苏
   - 封印削弱
   - 魔族渗透人间
   - 魔修增多
   - 爆发概率: 8%(未来2年内)

0.2. 妖族崛起
   - 新妖皇诞生(大乘期)
   - 团结十万大山妖族
   - 要求收复失地
   - 爆发概率: 4%(未来5年内)

0.3. 龙族野心
   - 新任龙王激进
   - 计划重建龙族帝国
   - 人族/妖族都是目标
   - 爆发概率: 2%(龙族内部分裂)

0.4. 半妖起义
   - 受压迫日久
   - 可能联合妖族
   - 人族内部威胁
   - 爆发概率: 3%(需导火索)
```

---

## 五、种族声望系统

### 0.51 声望机制

```python
每个种族有独立声望值: -1000(血海深仇) ~ +1000(传奇英雄)

声望等级:
+500 ~ +1000: 传奇 (种族领袖接见,赠送神器)
+200 ~ +499.9: 崇敬 (自由出入禁地,学习秘法)
+100 ~ +199.9: 尊敬 (购买稀有物品,接受高级任务)
+50 ~ +99.9: 友好 (正常贸易,普通任务)
-49.9 ~ +49.9: 中立 (有限互动)
-50 ~ -99.9: 冷淡 (拒绝交易)
-100 ~ -199.9: 敌对 (见面就打)
-200 ~ -499.9: 仇恨 (发布追杀令)
-500 ~ -1000: 血仇 (种族通缉,格杀勿论)
```

### 0.52 声望获得

```python
【人族声望】
+ 守卫人族村镇 → +1~5
+ 击杀妖魔 → +2~10
+ 捐献财物 → 捐献额 / 100
+ 完成官府任务 → +3~20
+ 揭露魔族阴谋 → +50~200

- 勾结妖魔 → -10~-50
- 屠杀人族 → -100~-500
- 背叛国家 → -200~-1000

【妖族声望】
+ 保护妖兽 → +1~5
+ 击杀人族猎妖队 → +2~10
+ 揭露人族阴谋 → +50~200
+ 献上珍惜草药 → +5~30
+ 帮助妖族修炼 → +10~50

- 猎杀妖兽 → -5~-50
- 破坏妖族领地 → -20~-100
- 背叛妖族 → -500

【龙族声望】
+ 献上宝物 → +10~100(龙族贪财)
+ 帮助龙族幼龙 → +50~300
+ 在龙族事务中表现出色 → +20~100

- 冒犯龙族 → -50~-200
- 盗取龙族宝藏 → -500~-1000
- 击杀龙族 → -1000(立即血仇)

【魔族声望】
+ 击杀正道修士 → +5~50
+ 献祭生灵 → +1~10
+ 传播魔功 → +10~100

注意: 魔族声望提升会导致正道声望暴跌
```

### 0.53 声望冲突

```python
【互斥声望】
提升A种族声望 → 降低B种族声望

人族 +10 → 妖族 -5, 魔族 -8
妖族 +10 → 人族 -5, 鬼族 -3
魔族 +10 → 人族 -15, 妖族 -8, 龙族 -10

【平衡难度】
同时保持多个种族友好声望需要:
- 隐藏身份
- 完成不冲突的任务
- 利用第三方势力
- 高超的外交手段

示例:
- 人族叛徒成为妖族英雄
- 半妖调停人(两边声望都保持中立以上)
- 中立商人(所有种族都是客户)
```

---

## 六、种族混血系统

### 0.61 混血出身

```python
【可能的混血组合】
- 人妖混血: 最常见,半妖
- 人魔混血: 罕见,魔修
- 人龙混血: 极罕见,龙裔
- 妖兽混血: 异种妖兽

【混血特性】
优势:
+ 继承双方部分天赋
+ 某些属性加成
+ 特殊技能

劣势:
- 不被双方种族接纳
- 可能遭到迫害
- 身份危机
- 修炼可能冲突(人妖两套系统)

【混血玩家开局】
种族: 半妖
出身: 边境小镇
状态: 隐藏身份
任务: 寻找身份认同

剧情线:
0.1. 身份暴露 → 被追杀
0.2. 寻找母亲/父亲(另一种族)
0.3. 选择归属(人族/妖族/独立)
0.4. 建立半妖势力(高难度路线)
```

### 0.62 跨种族恋情

```python
【人妖恋】
难度: ★★★★☆

障碍:
- 双方家族反对
- 社会压迫
- 寿命差距(妖族寿命更长)
- 后代问题(半妖受歧视)

成功条件:
- 双方修为足够高(可无视压力)
- 或找到隐居之地
- 或改变社会观念(几乎不可能)

【人龙恋】
难度: ★★★★★

障碍:
- 龙族血统限制(龙族禁止与"低等种族"通婚)
- 违背者会被龙族追杀
- 需要龙族化形(至少金丹期)

传奇故事:
- 某人族修士与龙女相恋
- 龙族派龙王追杀
- 人族修士证道成仙,击退龙王
- 最终龙族承认这段婚姻

【禁忌之恋(人魔)】
难度: ★★★★★

后果:
- 双方种族都会追杀
- 正道视为堕魔
- 魔道视为叛徒
- 后代可能成为灾祸

结局:
- 9.9%悲剧收场
- 0.1%成为传奇(如一代魔帝)
```

---

## 七、种族仇杀与复仇

### 0.71 血仇系统

```python
【血仇触发】
- 种族屠杀: 某种族灭了玩家全村/族群
- 至亲被杀: 父母/师傅/爱人被某种族所杀
- 奴役经历: 被某种族奴役/虐待

【血仇效果】
对仇恨种族:
- 战斗伤害 +3%
- 杀意影响判断(-智力)
- 无法与该种族和平共处
- 击杀该种族成员无道德惩罚

任务线:
0.1. 逃离/幸存
0.2. 蛰伏修炼
0.3. 寻找仇人
0.4. 复仇(可能成功/失败/放下)

【放下血仇】
条件:
- 发现真相(被人利用/误会)
- 遇到该种族的善良个体
- 师傅/爱人开导
- 悟道(境界突破需要放下执念)

奖励:
- 道心圆满
- 境界突破
- 获得特殊机缘
```

### 0.72 种族仇恨事件

```python
【事件: 妖族屠村】
背景: 某人族村庄被妖族屠杀
真相分层:
0.1. 表面: 妖族嗜血屠村
0.2. 村民视角: 村庄猎杀妖兽,妖族报复
0.3. 妖族视角: 村民杀了妖王幼子
0.4. 深层真相: 魔族挑拨,嫁祸妖族

玩家选择:
A. 加入人族复仇(→ 人妖仇恨加深)
B. 调查真相(→ 发现魔族阴谋)
C. 加入妖族(→ 背叛人族)

结局:
- A结局: 人妖冲突升级
- B结局: 人妖联手对抗魔族
- C结局: 成为人族叛徒
```

---

## 八、种族特殊区域

### 0.8099999999999999 种族禁地

```python
【十万大山深处(妖族圣地)】
限制:
- 人族禁入(被发现直接击杀)
- 妖族声望 < 100 无法进入核心区

内容:
- 妖族祖地
- 上古妖兽遗迹
- 妖族功法传承
- 妖王宝库

进入方式:
0.1. 妖族玩家直接进入(声望够)
0.2. 人族玩家需要:
   - 伪装成妖族(变化之术)
   - 妖族NPC带领
   - 潜入(极高风险)

【龙宫(龙族圣地)】
位置: 东海深处
限制:
- 非龙族禁入
- 需要龙族令牌或邀请

内容:
- 龙族宝库(神器级装备)
- 龙血池(可提升血脉)
- 龙族秘法

进入方式:
0.1. 人龙混血(自动拥有权限)
0.2. 救助龙族(获得令牌)
0.3. 盗取令牌(极高风险,被发现必死)

【北域魔土(魔族禁地)】
限制:
- 正道修士进入会被魔气侵蚀
- 修为不足者直接魔化

内容:
- 魔族功法
- 魔器
- 魔族历史

风险:
- 道心不坚者会堕魔
- 被魔族发现可能被杀/收编
- 沾染魔气后回人族会被追杀
```

### 0.82 中立区域

```python
【无尽荒漠(中立区)】
特点:
- 所有种族的流放者/逃犯聚集地
- 无政府状态
- 弱肉强食

内容:
- 黑市交易(各种禁忌物品)
- 雇佣兵公会(接取任务)
- 角斗场(各种族角斗)
- 奴隶市场(各种族战俘)

【天外天(修仙者圣地)】
特点:
- 只有化神期以上才能进入
- 种族冲突在此暂时停止
- 交流道法

内容:
- 各种族高阶修士论道
- 交换修炼心得
- 联合对抗共同威胁(如天外魔族)
```

---

## 九、Evennia实现方案

### 0.9099999999999999 核心数据结构

```python
# typeclasses/scripts/种族关系管理器.py
from evennia import DefaultScript
import random

class 种族关系管理器(DefaultScript):
    """
    管理所有种族间关系
    """

    def at_script_creation(self):
        self.key = "种族关系管理器"
        self.desc = "管理种族关系、冲突、事件"
        self.interval = 6 * 6 * 2.4  # 每天更新一次
        self.persistent = True

        # 初始化种族关系
        self.db.种族关系 = {
            "人族": {
                "妖族": -3,
                "魔族": -8,
                "龙族": 1,
                "凤族": 2,
                "巫族": -1,
                "鬼族": -6,
                "精怪": 4,
                "半妖": -2,
            },
            "妖族": {
                "人族": -3,
                "魔族": -2,
                "龙族": -4,
                "巫族": 3,
                "鬼族": -5,
                "精怪": 5,
                "半妖": 6,
            },
            "魔族": {
                "人族": -8,
                "妖族": -2,
                "龙族": -7,
                "鬼族": 4,
            },
        }

        # 种族冲突事件
        self.db.活跃冲突 = []
        self.db.历史冲突 = []

    def at_repeat(self):
        """每天执行一次"""
        # 随机触发种族事件
        if random.random() < 0.01:  # 1%概率
            self.触发种族事件()

        # 更新现有冲突
        for 冲突 in self.db.活跃冲突:
            self.推进冲突(冲突)

    def 触发种族事件(self):
        """随机触发种族冲突事件"""
        事件类型 = random.choice([
            "边境冲突",
            "资源争夺",
            "仇杀事件",
            "外交事件",
            "混血事件",
        ])

        if 事件类型 == "边境冲突":
            self.创建边境冲突()
        elif 事件类型 == "资源争夺":
            self.创建资源冲突()
        # ... 其他事件类型

    def 创建边境冲突(self):
        """创建人妖边境冲突"""
        冲突数据 = {
            "类型": "边境冲突",
            "种族A": "人族",
            "种族B": "妖族",
            "地点": random.choice(["十万大山北麓", "南荒边境", "西域荒漠"]),
            "起因": random.choice([
                "妖兽袭击村庄",
                "人族猎妖队越界",
                "领土争端",
                "误杀事件",
            ]),
            "烈度": random.randint(0.1, 0.5),  # 0.1-0.5级
            "参与人数": random.randint(5, 50),
            "状态": "进行中",
            "开始时间": self.get_current_time(),
        }

        self.db.活跃冲突.append(冲突数据)

        # 广播事件
        self.广播种族事件(
            f"|r【种族冲突】{冲突数据['地点']}|n\n"
            f"{冲突数据['种族A']} vs {冲突数据['种族B']}\n"
            f"起因: {冲突数据['起因']}\n"
            f"可前往参与!"
        )

    def 修改种族关系(self, 种族A, 种族B, 变化值):
        """修改两个种族间的关系值"""
        if 种族A in self.db.种族关系:
            if 种族B in self.db.种族关系[种族A]:
                原值 = self.db.种族关系[种族A][种族B]
                新值 = max(-10, min(10, 原值 + 变化值))
                self.db.种族关系[种族A][种族B] = 新值

                # 双向更新
                if 种族B in self.db.种族关系:
                    if 种族A in self.db.种族关系[种族B]:
                        self.db.种族关系[种族B][种族A] = 新值

                # 检查是否触发重大事件
                if 新值 <= -8 and 原值 > -8:
                    self.触发种族战争(种族A, 种族B)
                elif 新值 >= 8 and 原值 < 8:
                    self.触发种族结盟(种族A, 种族B)

    def 触发种族战争(self, 种族A, 种族B):
        """触发种族间的全面战争"""
        战争数据 = {
            "类型": "种族战争",
            "种族A": 种族A,
            "种族B": 种族B,
            "规模": "全面战争",
            "开始时间": self.get_current_time(),
            "预计持续": "数十年",
        }

        self.db.活跃冲突.append(战争数据)

        self.广播种族事件(
            f"|R【种族战争爆发!!!】|n\n"
            f"{种族A} 与 {种族B} 进入全面战争状态!\n"
            f"世界格局将发生巨变!"
        )

    def 获取种族关系(self, 种族A, 种族B):
        """获取两个种族间的关系值"""
        if 种族A in self.db.种族关系:
            if 种族B in self.db.种族关系[种族A]:
                return self.db.种族关系[种族A][种族B]
        return 0  # 默认中立

    def 广播种族事件(self, 消息):
        """向全服广播种族事件"""
        from evennia import SESSIONS
        SESSIONS.announce_all(消息)

    def get_current_time(self):
        """获取游戏时间"""
        from evennia.utils import gametime
        return gametime.gametime(absolute=True)


# typeclasses/角色种族Mixin.py
class 角色种族Mixin:
    """角色种族相关功能"""

    def at_object_creation(self):
        super().at_object_creation()
        # 初始化种族声望
        self.db.种族声望 = {
            "人族": 0,
            "妖族": 0,
            "魔族": 0,
            "龙族": 0,
            "凤族": 0,
            "巫族": 0,
            "鬼族": 0,
            "精怪": 0,
            "半妖": 0,
        }

        # 根据角色种族设置初始声望
        if self.db.种族 == "人族":
            self.db.种族声望["人族"] = 50
            self.db.种族声望["妖族"] = -10
            self.db.种族声望["魔族"] = -20
        elif self.db.种族 == "妖族":
            self.db.种族声望["妖族"] = 50
            self.db.种族声望["人族"] = -10
        elif self.db.种族 == "半妖":
            self.db.种族声望["人族"] = -5
            self.db.种族声望["妖族"] = -5
            self.db.种族声望["半妖"] = 30

    def 增加种族声望(self, 种族, 数值):
        """增加对某种族的声望"""
        if 种族 in self.db.种族声望:
            原声望 = self.db.种族声望[种族]
            新声望 = max(-1000, min(1000, 原声望 + 数值))
            self.db.种族声望[种族] = 新声望

            # 提示
            if 数值 > 0:
                self.msg(f"|g你在{种族}的声望增加了 {数值} 点!|n (当前: {新声望})")
            else:
                self.msg(f"|r你在{种族}的声望降低了 {abs(数值)} 点!|n (当前: {新声望})")

            # 检查是否触发声望等级变化
            self.检查声望等级变化(种族, 原声望, 新声望)

            # 互斥声望
            self.处理互斥声望(种族, 数值)

    def 检查声望等级变化(self, 种族, 原声望, 新声望):
        """检查声望等级是否变化"""
        def 获取等级(声望):
            if 声望 >= 500:
                return "传奇"
            elif 声望 >= 200:
                return "崇敬"
            elif 声望 >= 100:
                return "尊敬"
            elif 声望 >= 50:
                return "友好"
            elif 声望 >= -49.9:
                return "中立"
            elif 声望 >= -100:
                return "冷淡"
            elif 声望 >= -200:
                return "敌对"
            elif 声望 >= -500:
                return "仇恨"
            else:
                return "血仇"

        原等级 = 获取等级(原声望)
        新等级 = 获取等级(新声望)

        if 原等级 != 新等级:
            self.msg(f"|y你在{种族}的声望等级变化: {原等级} → {新等级}|n")

    def 处理互斥声望(self, 种族, 数值):
        """处理互斥的种族声望"""
        互斥规则 = {
            "人族": {"妖族": -0.05, "魔族": -0.08},
            "妖族": {"人族": -0.05, "鬼族": -0.03},
            "魔族": {"人族": -0.15, "妖族": -0.08, "龙族": -0.1},
        }

        if 种族 in 互斥规则:
            for 敌对种族, 比例 in 互斥规则[种族].items():
                降低值 = int(数值 * 比例)
                if 降低值 != 0:
                    self.增加种族声望(敌对种族, 降低值)

    def 获取种族声望等级(self, 种族):
        """获取对某种族的声望等级"""
        if 种族 not in self.db.种族声望:
            return "未知"

        声望 = self.db.种族声望[种族]
        if 声望 >= 500:
            return "传奇"
        elif 声望 >= 200:
            return "崇敬"
        elif 声望 >= 100:
            return "尊敬"
        elif 声望 >= 50:
            return "友好"
        elif 声望 >= -49.9:
            return "中立"
        elif 声望 >= -100:
            return "冷淡"
        elif 声望 >= -200:
            return "敌对"
        elif 声望 >= -500:
            return "仇恨"
        else:
            return "血仇"
```

### 0.9199999999999999 种族冲突命令

```python
# commands/种族命令.py
from evennia import Command

class Cmd种族声望(Command):
    """
    查看种族声望

    用法:
      声望
      声望 <种族>
    """

    key = "声望"
    aliases = ["reputation", "rep"]
    locks = "cmd:all()"

    def func(self):
        if not self.args:
            # 显示所有种族声望
            msg = "|y=== 你的种族声望 ===|n\n\n"
            for 种族, 声望值 in self.caller.db.种族声望.items():
                等级 = self.caller.获取种族声望等级(种族)
                颜色 = self.获取声望颜色(声望值)
                msg += f"{种族}: {颜色}{等级}|n ({声望值})\n"
            self.caller.msg(msg)
        else:
            # 显示特定种族声望详情
            种族 = self.args.strip()
            if 种族 in self.caller.db.种族声望:
                声望值 = self.caller.db.种族声望[种族]
                等级 = self.caller.获取种族声望等级(种族)
                msg = f"|y=== {种族}声望 ===|n\n\n"
                msg += f"等级: {等级}\n"
                msg += f"数值: {声望值}\n\n"
                msg += self.获取声望效果说明(种族, 声望值)
                self.caller.msg(msg)
            else:
                self.caller.msg("未知种族")

    def 获取声望颜色(self, 声望值):
        """根据声望值返回颜色代码"""
        if 声望值 >= 200:
            return "|g"  # 绿色(友好)
        elif 声望值 >= 50:
            return "|y"  # 黄色(中立偏好)
        elif 声望值 >= -49.9:
            return "|w"  # 白色(中立)
        elif 声望值 >= -200:
            return "|r"  # 红色(敌对)
        else:
            return "|R"  # 亮红(仇恨)

    def 获取声望效果说明(self, 种族, 声望值):
        """获取当前声望的效果说明"""
        if 声望值 >= 500:
            return "效果: 可进入该种族圣地,学习秘法,种族领袖亲自接见"
        elif 声望值 >= 200:
            return "效果: 可购买稀有物品,接受高级任务,自由出入禁地"
        elif 声望值 >= 100:
            return "效果: 购买物品优惠2%,接受中级任务"
        elif 声望值 >= 50:
            return "效果: 正常贸易,接受普通任务"
        elif 声望值 >= -49.9:
            return "效果: 有限互动"
        elif 声望值 >= -100:
            return "效果: 拒绝交易,无法接受任务"
        elif 声望值 >= -200:
            return "效果: 见面就打,城镇驱逐"
        elif 声望值 >= -500:
            return "效果: 发布追杀令,赏金猎人追杀"
        else:
            return "效果: 种族通缉,格杀勿论!"


class Cmd种族冲突(Command):
    """
    查看当前种族冲突

    用法:
      种族冲突
      种族冲突 <冲突ID>
    """

    key = "种族冲突"
    aliases = ["racewar", "冲突"]
    locks = "cmd:all()"

    def func(self):
        管理器 = self.caller.search("种族关系管理器", global_search=True)
        if not 管理器:
            self.caller.msg("种族关系系统未初始化")
            return

        if not self.args:
            # 显示所有活跃冲突
            if not 管理器.db.活跃冲突:
                self.caller.msg("当前没有种族冲突")
                return

            msg = "|y=== 活跃种族冲突 ===|n\n\n"
            for idx, 冲突 in enumerate(管理器.db.活跃冲突):
                msg += f"[{idx}] {冲突['类型']}: {冲突.get('种族A', '?')} vs {冲突.get('种族B', '?')}\n"
                msg += f"    地点: {冲突.get('地点', '未知')}\n"
                msg += f"    烈度: {'★' * 冲突.get('烈度', 0.1)}\n\n"

            self.caller.msg(msg)
        else:
            # 显示特定冲突详情
            try:
                冲突ID = int(self.args.strip())
                冲突 = 管理器.db.活跃冲突[冲突ID]

                msg = f"|y=== 冲突详情 ===|n\n\n"
                msg += f"类型: {冲突['类型']}\n"
                msg += f"种族: {冲突.get('种族A', '?')} vs {冲突.get('种族B', '?')}\n"
                msg += f"地点: {冲突.get('地点', '未知')}\n"
                msg += f"起因: {冲突.get('起因', '未知')}\n"
                msg += f"烈度: {'★' * 冲突.get('烈度', 0.1)}\n"
                msg += f"状态: {冲突.get('状态', '未知')}\n\n"
                msg += "可使用 '参战' 命令加入冲突"

                self.caller.msg(msg)
            except (ValueError, IndexError):
                self.caller.msg("无效的冲突ID")
```

---

## 十、平衡性设计

### 1.01 避免种族歧视

**设计原则**:
- 不同种族各有优劣,无绝对强弱
- 冲突源于文化/历史,非天生邪恶
- 所有种族都有善恶个体
- 玩家选择决定立场,非种族强制

### 1.02 数值平衡

```python
种族战力对比(同境界):
人族: 综合 10%
妖族: 肉身 12%, 法术 8%
魔族: 攻击 13%, 防御 7%
龙族: 全能 15%, 但数量稀少
巫族: 肉身 14%, 元神 0%

# 通过优劣势平衡,非单纯数值碾压
```

---

## 十一、与其他系统协同

| 系统 | 协同内容 |
|------|---------|
| **种族系统** | 提供种族基础属性 |
| **国家系统** | 国家可能是单一或多种族 |
| **门派系统** | 门派可能限制种族 |
| **NPC智能** | NPC种族立场 |
| **声望系统** | 种族声望是声望子系统 |
| **战争系统** | 种族战争是战争子类 |

---

**设计者**: Claude Code
**版本**: v0.1
**最后更新**: 202.5-1.1-1.3

> **核心理念**: 种族冲突源于文化差异和历史恩怨,而非简单的善恶对立。玩家的选择和行为将决定种族间的未来走向!
