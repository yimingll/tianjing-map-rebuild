# 天京城地图重构设计文档

## 📋 文档概览

本目录包含天京城140房间地图重构的完整设计方案。重构的核心目标是优化11个区域的房间分配,并实现中心辐射式、环形、网格式、层级式四种连通方式。

---

## 📁 文档列表

### 1. [重构总体设计](./1_重构总体设计.md) ⭐必读
**内容**:
- 重构目标与原则
- 房间分配对比表 (原有 vs 优化后)
- 四种连通性架构说明
- 实施步骤与时间规划
- 质量保证清单
- 风险评估与应对

**适合人群**: 所有参与者
**预计阅读时间**: 15分钟

### 2. [各区域详细设计](./2_各区域详细设计.md)
**内容**:
- 11个区域的完整房间列表
- 每个房间的ID、名称、类型、描述
- 区域内部连接关系
- 区域间对外接口定义

**适合人群**: 地图设计师、内容编写者
**预计阅读时间**: 30分钟

### 3. [跨区域连接与坐标设计](./3_跨区域连接与坐标设计.md)
**内容**:
- 中心辐射式连接详细路径
- 内环/外环/中环路径设计
- 网格式主轴与副轴规划
- 层级式三层架构
- 1000×1000坐标系统
- 关键房间坐标表
- 11×11区域连接矩阵

**适合人群**: 系统架构师、技术实现者
**预计阅读时间**: 25分钟

---

## 🎯 快速开始

### 第一次阅读本文档?

**推荐阅读顺序**:
1. 阅读本README (5分钟)
2. 阅读 `1_重构总体设计.md` 了解全貌 (15分钟)
3. 根据职责阅读对应的详细文档:
   - **设计师/策划**: 重点看 `2_各区域详细设计.md`
   - **程序员**: 重点看 `3_跨区域连接与坐标设计.md`
4. 准备实施时,按照总体设计中的步骤执行

### 已经了解基本方案?

**直接查阅**:
- 查看某个区域的房间列表 → `2_各区域详细设计.md`
- 查看区域间如何连接 → `3_跨区域连接与坐标设计.md` 第6节
- 查看坐标分配 → `3_跨区域连接与坐标设计.md` 第5节
- 查看实施步骤 → `1_重构总体设计.md` 第六节

---

## 📊 核心数据一览

### 房间分配概览

| 区域 | 当前 | 优化后 | 变化 |
|------|------|--------|------|
| 皇城区 | 31 | 25 | -6 |
| 商业区 | 10 | 15 | +5 |
| 东城区 | 20 | 18 | -2 |
| 西城区 | 16 | 15 | -1 |
| 官府区 | 12 | 14 | +2 |
| 南门区 | 11 | 13 | +2 |
| 北门区 | 8 | 10 | +2 |
| 贫民区 | 11 | 12 | +1 |
| 城墙区 | 8 | 10 | +2 |
| 东门区 | 4 | 4 | 0 |
| 西门区 | 4 | 4 | 0 |
| **总计** | **140** | **140** | **0** |

### 连通性概览

✅ **中心辐射式**: 以宫前广场为核心,8个方向连接到其他区域
✅ **外环线**: 四大城门环形路径,约30-35个房间
✅ **内环线**: 商业生活环线,约15-20个房间
✅ **网格式**: 横向长安街轴 + 纵向御街轴 + 4条副轴
✅ **层级式**: 外围防御层 → 功能区域层 → 权力核心层

### 关键指标

- **总房间数**: 140个 (不变)
- **区域数**: 11个 (不变)
- **核心枢纽**: 7个 (宫前广场、六部广场、御街中段等)
- **跨区域连接**: 40个连接点
- **平均区域连接度**: 3.6
- **最远距离**: 从宫前广场到任意房间 < 10步
- **地图尺寸**: 1000 × 1000 坐标单位

---

## 🔧 技术实施

### 涉及的文件

**JSON数据文件 (3个)**:
- `D:\mud\ceshi3\packages\server\data\maps\dazhou\tianjing_fu\tianjing_cheng_part1.json`
- `D:\mud\ceshi3\packages\server\data\maps\dazhou\tianjing_fu\tianjing_cheng_part2.json`
- `D:\mud\ceshi3\packages\server\data\maps\dazhou\tianjing_fu\tianjing_cheng_part3.json`

**需要修改的主要字段**:
```json
{
  "districts": [
    {
      "id": "区域ID",
      "name": "区域名称",
      "locations": [
        {
          "rooms": [
            {
              "id": "房间ID",
              "name": "房间名称",
              "exits": [
                {
                  "direction": "方向",
                  "targetRoomId": "目标房间ID",
                  "description": "描述"
                }
              ],
              "coordinates": {
                "x": 坐标X,
                "y": 坐标Y
              }
            }
          ]
        }
      ]
    }
  ]
}
```

### 实施阶段

**阶段一**: Part1重构 (南门区、皇城区、商业区)
**阶段二**: Part2重构 (东城区、西城区、官府区)
**阶段三**: Part3重构 (四门区、城墙区、贫民区)
**阶段四**: 整合测试与优化

预计总工期: 8-10天

---

## ✅ 质量检查

### 必须验证的项目

在实施完成后,使用以下清单进行验证:

#### 基础验证
- [ ] 房间总数 = 140
- [ ] 每个房间ID唯一
- [ ] 所有exit的targetRoomId都存在
- [ ] 双向连接对称 (A→B 则 B→A)
- [ ] 无孤立房间或区域

#### 连通性验证
- [ ] 中心辐射: 宫前广场能到达所有其他区域
- [ ] 外环线: 南门→东门→北门→西门→南门 畅通
- [ ] 内环线: 商业→东城→官府→西城→商业 畅通
- [ ] 网格式: 长安街横轴 + 御街纵轴 完整
- [ ] 层级式: 外围→功能→核心 层层递进

#### 坐标验证
- [ ] 所有房间坐标在0-1000范围内
- [ ] 同一区域的房间坐标在该区域范围内
- [ ] 相邻房间坐标距离合理 (20-50单位)
- [ ] 无重叠冲突

#### 游戏体验验证
- [ ] 从任意房间到宫前广场 < 10步
- [ ] 每个区域至少3个对外出口
- [ ] 白家老宅12房间完整保留
- [ ] 贫民区4个危险区域正确标记

---

## 📈 后续扩展

### 短期扩展方向 (1-3个月)
- 城郊农田区 (+20房间)
- 地下系统 (+15房间)
- 城外驿站区 (+10房间)

### 中期扩展方向 (3-6个月)
- 皇宫内殿开放 (+30房间)
- 江南码头区 (+25房间)
- 修仙宗门区 (+40房间)

### 长期扩展方向 (6-12个月)
- 连接其他城市
- 秘境副本系统
- 飞行空中区域

---

## 🤝 贡献者

### 设计团队
- 总体架构: Claude Code
- 区域设计: Claude Code
- 连接规划: Claude Code
- 坐标系统: Claude Code

### 实施团队
- (待补充)

---

## 📝 版本历史

### v1.0 (2025-11-18)
- ✅ 完成总体设计文档
- ✅ 完成各区域详细设计
- ✅ 完成连接与坐标设计
- ⏳ 待审核后开始实施

---

## 📞 联系方式

如有疑问或建议,请:
1. 在项目issue中提出
2. 联系项目负责人
3. 在团队会议中讨论

---

## 🔖 快速索引

### 按区域查找

- [皇城区](./2_各区域详细设计.md#1-皇城区) - 25房间
- [商业区](./2_各区域详细设计.md#2-商业区) - 15房间
- [东城区](./2_各区域详细设计.md#3-东城区) - 18房间 (含白家老宅12房)
- [西城区](./2_各区域详细设计.md#4-西城区) - 15房间
- [官府区](./2_各区域详细设计.md#5-官府区) - 14房间
- [南门区](./2_各区域详细设计.md#6-南门区) - 13房间
- [北门区](./2_各区域详细设计.md#7-北门区) - 10房间
- [贫民区](./2_各区域详细设计.md#8-贫民区) - 12房间
- [城墙区](./2_各区域详细设计.md#9-城墙区) - 10房间
- [东门区](./2_各区域详细设计.md#10-东门区) - 4房间
- [西门区](./2_各区域详细设计.md#11-西门区) - 4房间

### 按连通方式查找

- [中心辐射式](./3_跨区域连接与坐标设计.md#1-中心辐射式连接)
- [环形连通](./3_跨区域连接与坐标设计.md#2-环形连通路径)
- [网格式](./3_跨区域连接与坐标设计.md#3-网格式交叉)
- [层级式](./3_跨区域连接与坐标设计.md#4-层级式结构)

### 按坐标查找

- [整体布局](./3_跨区域连接与坐标设计.md#51-整体布局)
- [区域坐标范围](./3_跨区域连接与坐标设计.md#52-各区域坐标范围)
- [关键房间坐标](./3_跨区域连接与坐标设计.md#53-关键房间坐标表)

---

**最后更新**: 2025-11-18
**文档状态**: 待审核
**下一步**: 等待项目负责人审核批准后开始实施
