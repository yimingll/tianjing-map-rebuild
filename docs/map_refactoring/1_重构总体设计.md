# 天京城地图重构总体设计

## 一、重构目标

### 核心目标
1. **优化房间分配** - 使11个区域的房间分布更加均衡合理
2. **保持总量不变** - 维持140个房间总数
3. **增强连通性** - 实现多种连通方式(中心辐射式、环形、网格式、层级式)
4. **提升游戏体验** - 让玩家在城市中移动更加流畅自然

### 设计原则
- **合理性**: 区域房间数量与其重要性和功能相匹配
- **连通性**: 每个区域至少有3条以上路径连接其他区域
- **层次性**: 从外围到核心,体现层级递进
- **趣味性**: 保留特色建筑(如白家老宅),增加探索乐趣

---

## 二、房间分配对比

| 区域 | 当前房间数 | 优化后房间数 | 变化 | 说明 |
|------|-----------|-------------|------|------|
| **皇城区** | 31 | 25 | -6 | 核心区域,仍保持最多房间 |
| **商业区** | 10 | 15 | +5 | 繁华商业街,需要更多店铺 |
| **东城区** | 20 | 18 | -2 | 豪门区,保留白家老宅12房 |
| **西城区** | 16 | 15 | -1 | 平民区,规模适中 |
| **官府区** | 12 | 14 | +2 | 六部衙门,需要更多空间 |
| **南门区** | 11 | 13 | +2 | 主要入口,增加广场设施 |
| **北门区** | 8 | 10 | +2 | 防御要地,完善布局 |
| **贫民区** | 11 | 12 | +1 | 底层社会,略微扩展 |
| **城墙区** | 8 | 10 | +2 | 防御工事,完善四角 |
| **东门区** | 4 | 4 | 0 | 贸易门户,保持简洁 |
| **西门区** | 4 | 4 | 0 | 丝路门户,保持简洁 |
| **总计** | **140** | **140** | **0** | ✓ 总数不变 |

---

## 三、连通性架构

### 3.1 中心辐射式 (Hub-and-Spoke)

**核心枢纽: 宫前广场 (tj_palace_square)**

```
                  北门区
                    ↑
                    |
    西城区 ← 宫前广场 → 东城区
                    |
                    ↓
                 商业区
                    |
                    ↓
                 南门区
```

**辐射连接**:
- 宫前广场 → 南门区 (via 御街)
- 宫前广场 → 商业区 (via 御街)
- 宫前广场 → 东城区 (via 东长安街)
- 宫前广场 → 西城区 (via 西长安街)
- 宫前广场 → 官府区 (via 六部广场)
- 宫前广场 → 北门区 (via 中轴大道)

### 3.2 环形连通 (Ring Structure)

**外环 - 四大城门环线**:
```
南门区 → (东南路) → 东门区 → (东北路) → 北门区
   ↑                                         ↓
   |                                    (西北路)
   |                                         ↓
(西南路) ← 西门区 ← (沿城墙) ← 城墙区 ← 西门区
```

**内环 - 商业生活环线**:
```
商业区 → (大宅街) → 东城区 → (东长安街) → 官府区
  ↑                                         ↓
  |                                    (西大街)
  |                                         ↓
(御街) ←─────────── 西城区 ←────────── 西城区
```

### 3.3 网格式连接 (Grid Pattern)

**横向主轴**:
- 东城区 ↔ (东长安街) ↔ 皇城区 ↔ (西长安街) ↔ 西城区

**纵向主轴**:
- 北门区 ↔ (中轴大道) ↔ 皇城区 ↔ (御街) ↔ 商业区 ↔ (御街南段) ↔ 南门区

**横向副轴**:
- 东门区 ↔ (东市大街) ↔ 东城区 ↔ (六部街) ↔ 官府区 ↔ (西市街) ↔ 西城区 ↔ (西大街) ↔ 西门区

**交叉点 (关键枢纽房间)**:
1. 宫前广场 (中心交叉)
2. 六部广场 (官府交叉)
3. 东市广场 (东部交叉)
4. 西市广场 (西部交叉)
5. 御街中段 (南北交叉)

### 3.4 层级式结构 (Hierarchical Structure)

```
【第一层 - 外围防御层】(30房间)
├─ 南门区 (13房间) - 主入口
├─ 北门区 (10房间) - 后方防御
├─ 东门区 (4房间) - 东方贸易
└─ 西门区 (4房间) - 西方丝路
    城墙区 (10房间) - 环城防线

【第二层 - 功能区域层】(62房间)
├─ 商业区 (15房间) - 商业中心
├─ 东城区 (18房间) - 豪门府邸
├─ 西城区 (15房间) - 平民生活
├─ 贫民区 (12房间) - 社会底层
└─ 官府区 (14房间) - 行政中枢

【第三层 - 权力核心层】(25房间)
└─ 皇城区 (25房间) - 皇宫禁地
    ├─ 皇宫核心 (8房间)
    ├─ 国子监 (6房间)
    ├─ 钦天监 (5房间)
    └─ 宫殿广场 (6房间)
```

**层级连接规则**:
- 外围层 → 功能层: 每个城门区至少连接2个功能区
- 功能层 → 核心层: 所有功能区都可通过枢纽到达皇城
- 跨层捷径: 设置3-5条直达路径(如南门→商业→皇城)

---

## 四、重要地标与枢纽房间

### 核心枢纽 (Tier 1)
1. **宫前广场** (tj_palace_square) - 全城中心,8向连接
2. **六部广场** (tj_ministry_plaza) - 官府中心,6向连接
3. **御街中段** (tj_imperial_street_mid) - 南北主轴,4向连接

### 区域枢纽 (Tier 2)
4. **南门广场** (tj_south_gate_plaza) - 南部入口,5向连接
5. **东市广场** (tj_east_market_plaza) - 东部商业,4向连接
6. **西市广场** (tj_west_market_plaza) - 西部商业,4向连接
7. **北门大道** (tj_north_gate_avenue) - 北部防御,4向连接

### 特色地标 (Tier 3)
8. **白家老宅正门** (tj_bai_mansion_gate) - 东城特色,3向连接
9. **贫民区主巷** (tj_slum_main_alley) - 底层中心,8向连接
10. **城墙巡逻道** (tj_wall_patrol_path) - 环城通道,连接四角楼

---

## 五、坐标系统概览

### 地图整体范围
- **X轴**: 0 - 1000 (西→东)
- **Y轴**: 0 - 1000 (南→北)
- **中心点**: (500, 500) - 宫前广场

### 区域坐标分配
| 区域 | X范围 | Y范围 | 中心坐标 |
|------|-------|-------|---------|
| 皇城区 | 400-600 | 450-650 | (500, 550) |
| 商业区 | 420-580 | 350-449 | (500, 400) |
| 南门区 | 420-580 | 50-250 | (500, 150) |
| 北门区 | 420-580 | 750-950 | (500, 850) |
| 东城区 | 650-850 | 400-600 | (750, 500) |
| 西城区 | 150-350 | 400-600 | (250, 500) |
| 官府区 | 600-750 | 500-650 | (675, 575) |
| 东门区 | 850-950 | 450-550 | (900, 500) |
| 西门区 | 50-150 | 450-550 | (100, 500) |
| 城墙区 | 外围环形 | 外围环形 | 四角楼 |
| 贫民区 | 150-300 | 250-400 | (225, 325) |

---

## 六、实施步骤

### 阶段一: 准备工作 (Day 1)
1. ✓ 备份当前三个JSON文件
2. ✓ 创建详细设计文档
3. ✓ 确定各区域房间列表
4. ✓ 绘制连接关系图

### 阶段二: Part1重构 (Day 2-3)
**涉及区域**: 南门区、皇城区、商业区
- 重写南门区 (11→13房间)
- 精简皇城区 (31→25房间)
- 扩充商业区 (10→15房间)
- 更新区域间连接

### 阶段三: Part2重构 (Day 4-5)
**涉及区域**: 东城区、西城区、官府区
- 微调东城区 (20→18房间,保留白家老宅)
- 精简西城区 (16→15房间)
- 扩充官府区 (12→14房间)
- 完善环形连接

### 阶段四: Part3重构 (Day 6-7)
**涉及区域**: 北门区、东西门区、城墙区、贫民区
- 扩充北门区 (8→10房间)
- 保持东西门区 (各4房间)
- 完善城墙区 (8→10房间)
- 扩充贫民区 (11→12房间)
- 实现外环连通

### 阶段五: 整合测试 (Day 8)
1. 合并三个文件
2. 验证房间总数 (140个)
3. 测试所有连接路径
4. 检查坐标合理性
5. 验证连通性(无孤岛)

### 阶段六: 优化调整 (Day 9-10)
1. 根据测试结果调整
2. 优化房间描述文本
3. 完善NPC配置
4. 添加特殊事件点
5. 最终验收

---

## 七、质量保证清单

### 必须验证项
- [ ] 房间总数 = 140
- [ ] 每个房间ID唯一
- [ ] 所有exit的targetRoomId存在
- [ ] 双向连接对称(A→B则B→A)
- [ ] 无孤立房间或区域
- [ ] 坐标无重叠冲突
- [ ] 至少实现3种连通方式

### 推荐验证项
- [ ] 从任意房间到宫前广场 < 10步
- [ ] 四大城门环线畅通
- [ ] 内环商业线畅通
- [ ] 每个区域至少3个对外出口
- [ ] 特色建筑完整性(白家老宅、贫民区)

---

## 八、风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| 连接遗漏导致孤岛 | 高 | 使用脚本验证连通性 |
| 房间数不匹配 | 中 | 每阶段结束时清点 |
| 坐标冲突重叠 | 中 | 使用坐标表管理 |
| 描述文本不一致 | 低 | 统一风格指南 |
| 白家老宅结构破坏 | 高 | 单独保护该区域 |

---

## 九、后续扩展方向

### 短期扩展 (1-3个月)
- 添加城郊农田区 (+20房间)
- 扩展地下系统(下水道、密道) (+15房间)
- 添加城外驿站区 (+10房间)

### 中期扩展 (3-6个月)
- 开放皇宫内殿 (+30房间)
- 添加江南码头区 (+25房间)
- 扩展修仙宗门区 (+40房间)

### 长期扩展 (6-12个月)
- 连接其他城市(云州城等)
- 开放秘境副本
- 添加飞行系统和空中区域

---

**文档版本**: v1.0
**创建日期**: 2025-11-18
**负责人**: Claude Code
**审核状态**: 待审核
